# 要件定義書

## はじめに

テキストコンテンツ管理機能は、GitHubリポジトリに存在しないコマンドやエージェント、フックなどのテキストコンテンツを直接管理・デプロイできる仕組みを提供します。これにより、簡単なコマンドやスニペットをリポジトリを作成することなく、Claude Code Package Manager（CCPM）で管理できるようになります。

## 要件

### 要件1: テキストコンテンツの登録
**ユーザーストーリー:** ツール作成者として、リポジトリを作成せずに単一のコマンドやエージェントをCCPMに登録したい。これにより、小規模なツールの管理が簡単になる。

#### 受け入れ基準

1. WHEN ユーザーがテキストコンテンツ登録コマンドを実行する THEN システムはコンテンツタイプ（command/agent/hook）の選択を求める SHALL
2. WHEN ユーザーがコンテンツタイプとファイル名を指定する THEN システムはテキストエディタを起動してコンテンツの入力を可能にする SHALL
3. IF ユーザーが既存ファイルからのインポートを選択する THEN システムはファイルパスの入力を求めてコンテンツを読み込む SHALL
4. WHEN コンテンツが保存される THEN システムはコンテンツをローカルストレージに保存し、一意のIDを割り当てる SHALL
5. IF 同じファイル名のコンテンツが既に存在する THEN システムは上書き確認を求める SHALL
6. WHEN 登録が完了する THEN システムは登録されたコンテンツの概要を表示する SHALL

### 要件2: テキストコンテンツの管理
**ユーザーストーリー:** ツール管理者として、登録したテキストコンテンツを一覧表示し、編集・削除したい。これにより、コンテンツの整理と更新が容易になる。

#### 受け入れ基準

1. WHEN ユーザーがテキストコンテンツ一覧コマンドを実行する THEN システムは登録されたすべてのテキストコンテンツを表形式で表示する SHALL
2. WHERE 一覧表示中 THE SYSTEM SHALL タイプ、ファイル名、登録日時、デプロイ状態を含める
3. WHEN ユーザーが特定のコンテンツの編集を選択する THEN システムはテキストエディタでコンテンツを開く SHALL
4. IF ユーザーが編集後にコンテンツを保存する THEN システムは更新日時を記録し、デプロイ状態を「未デプロイ」に変更する SHALL
5. WHEN ユーザーがコンテンツの削除を選択する THEN システムは確認プロンプトを表示する SHALL
6. IF 削除が確認される AND コンテンツがデプロイ済みである THEN システムはデプロイ先からもファイルを削除する SHALL

### 要件3: テキストコンテンツのデプロイ
**ユーザーストーリー:** ツール利用者として、登録したテキストコンテンツをClaude Codeで使用できるようにデプロイしたい。これにより、カスタムツールが実際に利用可能になる。

#### 受け入れ基準

1. WHEN ユーザーがテキストコンテンツのデプロイコマンドを実行する THEN システムは未デプロイのコンテンツ一覧を表示する SHALL
2. IF ユーザーがすべてのコンテンツのデプロイを選択する THEN システムは各コンテンツをタイプに応じた適切なディレクトリにコピーする SHALL
3. WHERE デプロイ中 THE SYSTEM SHALL commands→~/.claude/commands/、agents→~/.claude/agents/、hooks→~/.claude/hooks/にファイルを配置する
4. IF デプロイ先に同名のファイルが存在する THEN システムは競合解決オプション（上書き/スキップ/プロンプト）に従って処理する SHALL
5. WHEN デプロイが完了する THEN システムはデプロイされたファイル数と結果を表示する SHALL
6. IF デプロイ中にエラーが発生する THEN システムはエラーの詳細とスキップされたファイルを報告する SHALL

### 要件4: リポジトリとテキストコンテンツの統合管理
**ユーザーストーリー:** パワーユーザーとして、リポジトリベースのツールとテキストコンテンツを統一的に管理したい。これにより、すべてのツールを一元的に把握できる。

#### 受け入れ基準

1. WHEN ユーザーがlistコマンドを実行する THEN システムはリポジトリとテキストコンテンツの両方を統合された一覧で表示する SHALL
2. WHERE 統合一覧表示中 THE SYSTEM SHALL ソースタイプ（repository/text）を明確に区別して表示する
3. WHEN ユーザーがupdateコマンドを実行する THEN システムはリポジトリの更新とテキストコンテンツのデプロイを同時に実行する SHALL
4. IF ユーザーがstatusコマンドを実行する THEN システムはリポジトリとテキストコンテンツの両方の状態を表示する SHALL
5. WHEN ユーザーがcleanコマンドを実行する THEN システムは孤立したテキストコンテンツ由来のファイルも検出・削除する SHALL

### 要件5: テキストコンテンツのエクスポート
**ユーザーストーリー:** ツール作成者として、登録したテキストコンテンツを他の環境で使用するためにエクスポートしたい。これにより、ツールの共有と配布が可能になる。

#### 受け入れ基準

1. WHEN ユーザーがテキストコンテンツのエクスポートコマンドを実行する THEN システムはエクスポート対象の選択肢を表示する SHALL
2. IF ユーザーが個別のコンテンツを選択する THEN システムは指定されたファイルパスにコンテンツを保存する SHALL
3. IF ユーザーがすべてのコンテンツのエクスポートを選択する THEN システムはタイプ別のディレクトリ構造でエクスポートする SHALL
4. WHEN エクスポートが実行される THEN システムはメタデータ（タイプ、元のファイル名、登録日時）を含むマニフェストファイルも生成する SHALL
5. WHERE エクスポート先にファイルが存在する場合 THE SYSTEM SHALL 上書き確認を求める

### 要件6: テキストコンテンツのインポート
**ユーザーストーリー:** ツール利用者として、他の環境からエクスポートされたテキストコンテンツをインポートしたい。これにより、ツールの移行と復元が簡単になる。

#### 受け入れ基準

1. WHEN ユーザーがテキストコンテンツのインポートコマンドを実行する THEN システムはインポート元の指定を求める SHALL
2. IF マニフェストファイルが存在する THEN システムはメタデータを読み込んでインポート対象を表示する SHALL
3. IF マニフェストファイルが存在しない THEN システムはファイルタイプの推測またはユーザーによる指定を求める SHALL
4. WHEN インポートが実行される THEN システムは既存のコンテンツとの重複をチェックする SHALL
5. IF 重複が検出される THEN システムはインポートオプション（上書き/スキップ/別名で保存）を提示する SHALL
6. WHEN インポートが完了する THEN システムはインポートされたコンテンツの概要を表示する SHALL

### 要件7: データ永続性とバックアップ
**ユーザーストーリー:** システム管理者として、テキストコンテンツのデータが安全に保存され、必要に応じて復元できることを確保したい。

#### 受け入れ基準

1. WHERE テキストコンテンツが保存される場所 THE SYSTEM SHALL $CCPM_HOME/text-content/ディレクトリを使用する
2. WHEN コンテンツが更新される THEN システムは更新前のバージョンをバックアップとして保持する SHALL
3. IF システムがクラッシュする THEN 保存されたテキストコンテンツは次回起動時に復元可能である SHALL
4. WHILE text-content.jsonファイルが更新される THE SYSTEM SHALL アトミックな書き込みを保証する
5. WHEN ユーザーがバックアップコマンドを実行する THEN システムはすべてのテキストコンテンツをアーカイブファイルとして保存する SHALL