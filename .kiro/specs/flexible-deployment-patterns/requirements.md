# 要件ドキュメント

## 概要
リポジトリ登録時にタイプを指定することで、リポジトリ直下のファイルやディレクトリを適切な場所にデプロイする機能を実装します。これにより、.claude/構造を持たないシンプルなリポジトリでも、agents、commands、hooksなどのツールを提供できるようになります。

## 要件

### 要件1: リポジトリ登録時のタイプ指定機能
**ユーザーストーリー:** ツール管理者として、リポジトリ登録時にリポジトリのタイプ（agents、commands、hooks等）を指定したい。これにより、リポジトリの構造に関わらず適切な場所にツールをデプロイできる。

#### 受け入れ基準
1. WHEN `ccpm register <url> --type agents` が実行される THEN システムはリポジトリタイプをagentsとして記録する
2. WHEN `ccpm register <url> --type commands` が実行される THEN システムはリポジトリタイプをcommandsとして記録する
3. WHEN `ccpm register <url> --type hooks` が実行される THEN システムはリポジトリタイプをhooksとして記録する
4. IF --typeオプションが指定されない場合 THEN システムは自動検出モード（従来の動作）を使用する
5. WHEN 無効なタイプが指定された場合 THEN システムはエラーメッセージと有効なタイプ一覧を表示する

### 要件2: タイプ別デプロイメントルール
**ユーザーストーリー:** 開発者として、指定されたタイプに基づいてリポジトリ直下のコンテンツを適切にデプロイしたい。これにより、.claude/構造を使わないシンプルなリポジトリ構造でツールを提供できる。

#### 受け入れ基準
1. WHEN リポジトリタイプがagentsの場合 THEN システムはリポジトリ直下のすべての.mdファイルとディレクトリを~/.claude/agents/にデプロイする
2. WHEN リポジトリタイプがcommandsの場合 THEN システムはリポジトリ直下のすべての.mdファイルとディレクトリを~/.claude/commands/にデプロイする
3. WHEN リポジトリタイプがhooksの場合 THEN システムはリポジトリ直下のすべての.mdファイルとディレクトリを~/.claude/hooks/にデプロイする
4. IF リポジトリ直下にREADME.mdが存在する場合 THEN システムはこのファイルをスキップする
5. WHILE デプロイ処理中 THE SYSTEM SHALL ディレクトリ構造を完全に保持する（例：repo/subdir/file.md → ~/.claude/agents/subdir/file.md）

### 要件3: リポジトリ構造の検証
**ユーザーストーリー:** システム管理者として、タイプ指定モードと自動検出モードを明確に分離し、混在による複雑性を排除したい。これにより、予測可能で管理しやすいシステムを維持できる。

#### 受け入れ基準
1. WHEN タイプが指定されたリポジトリに.mdファイルが1つも存在しない場合 THEN システムは警告を表示し、続行するか確認を求める
2. IF タイプが指定されていない場合 AND リポジトリに.claudeディレクトリも認識可能なパターン（agents/、commands/等）も存在しない場合 THEN システムはエラーを表示する
3. WHEN タイプ指定モードで.claude/構造が検出された場合 THEN システムはエラーを表示し、タイプ指定を外すか.claude/構造を削除するよう求める
4. WHEN タイプ指定モードでagents/、commands/、hooks/ディレクトリが検出された場合 THEN システムはエラーを表示する
5. WHERE 検証エラーが発生した場合 THE SYSTEM SHALL 具体的な問題と推奨される解決策を表示する
6. IF --forceオプションが指定された場合 THEN システムは警告を無視して登録を続行するが、構造の混在エラーは無視できない

### 要件4: デプロイメント情報の記録と表示
**ユーザーストーリー:** ユーザーとして、どのリポジトリがどのタイプでどこにデプロイされるかを確認したい。これにより、システムの動作を理解し、問題を診断できる。

#### 受け入れ基準
1. WHEN `ccpm list` が実行される THEN システムは各リポジトリのタイプ情報も表示する
2. WHEN `ccpm list --verbose` が実行される THEN システムはデプロイメントマッピングの詳細を表示する
3. WHERE repositories.jsonにリポジトリ情報が保存される際 THE SYSTEM SHALL タイプ情報とデプロイメントルールを記録する
4. WHEN `ccpm status` が実行される THEN システムはタイプ別のデプロイファイル数を表示する
5. IF デプロイメント時に競合が検出された場合 THEN システムは競合の詳細と影響を表示する

### 要件5: 後方互換性の維持
**ユーザーストーリー:** 既存ユーザーとして、新機能が追加されても既存のリポジトリと設定が正常に動作し続けることを保証してほしい。

#### 受け入れ基準
1. WHEN タイプが指定されていない既存のリポジトリが更新される THEN システムは従来の自動検出ロジックを使用する
2. IF 既存のrepositories.jsonにタイプ情報がない場合 THEN システムはデフォルトで自動検出モードを使用する
3. WHEN 古いバージョンからアップグレードされた場合 THEN システムは既存のデプロイメントを保持する
4. WHERE 設定の移行が必要な場合 THE SYSTEM SHALL 自動的に設定を更新し、変更内容をログに記録する
5. IF 破壊的変更が必要な場合 THEN システムは明確な移行ガイドを提供する